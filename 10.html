<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>Binance Perp USDT â€” 15m ì´ì „ë´‰ ì¦ê°ë¥  ìŠ¤ìºë„ˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --bg: #0b0c10;
            --card: #121318;
            --muted: #9aa0a6;
            --text: #e8eaed;
            --accent: #3ea6ff;
            --good: #00c853;
            --bad: #ff5252;
            --warn: #ffd54f;
            --border: #2a2e36;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI",
                         Roboto, "Helvetica Neue", Arial, "Apple SD Gothic Neo",
                         "Noto Sans KR", sans-serif;
            background: radial-gradient(circle at top, #151821 0, #050609 55%, #020308 100%);
            color: var(--text);
        }

        .app {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        header {
            margin-bottom: 16px;
        }

        header h1 {
            font-size: 20px;
            margin: 0 0 6px;
        }

        header p {
            margin: 0;
            font-size: 12px;
            color: var(--muted);
        }

        .card {
            background: rgba(18, 19, 24, 0.95);
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.7);
            padding: 12px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px 12px;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .controls-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button {
            padding: 8px 14px;
            border-radius: 999px;
            border: 1px solid var(--accent);
            background: linear-gradient(135deg, #1b2635, #162032);
            color: var(--text);
            font-size: 13px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        button:disabled {
            opacity: 0.6;
            cursor: default;
        }

        .status-text {
            color: var(--muted);
        }

        .status-text strong {
            color: var(--accent);
        }

        .meta {
            margin-left: auto;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: var(--muted);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid var(--border);
            font-size: 11px;
            background: rgba(0, 0, 0, 0.4);
        }

        .badge-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent);
        }

        .table-wrap {
            border-radius: 10px;
            border: 1px solid var(--border);
            overflow: hidden;
            max-height: calc(100vh - 220px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        thead {
            position: sticky;
            top: 0;
            z-index: 2;
        }

        thead th {
            background: #151821;
            padding: 8px 6px;
            text-align: right;
            border-bottom: 1px solid var(--border);
            font-weight: 500;
            color: var(--muted);
            white-space: nowrap;
        }

        thead th:first-child {
            text-align: left;
            padding-left: 10px;
        }

        tbody tr:nth-child(odd) {
            background: rgba(9, 10, 14, 0.9);
        }

        tbody tr:nth-child(even) {
            background: rgba(6, 7, 11, 0.9);
        }

        tbody td {
            padding: 6px 6px;
            text-align: right;
            border-bottom: 1px solid rgba(255, 255, 255, 0.02);
            white-space: nowrap;
        }

        tbody td:first-child {
            text-align: left;
            padding-left: 10px;
            font-weight: 600;
        }

        .sym {
            cursor: pointer;
        }

        .sym:hover {
            text-decoration: underline;
        }

        .chg-pos {
            color: var(--good);
        }

        .chg-neg {
            color: var(--bad);
        }

        .rank {
            font-size: 11px;
            color: var(--muted);
        }

        .empty-row td {
            text-align: center;
            padding: 14px 6px;
            color: var(--muted);
        }

        .small {
            font-size: 11px;
            color: var(--muted);
        }

        .code {
            font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 11px;
        }

        @media (max-width: 768px) {
            .app {
                padding: 10px;
            }

            header h1 {
                font-size: 18px;
            }

            .controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .meta {
                margin-left: 0;
            }

            thead th:nth-child(5),
            tbody td:nth-child(5) {
                display: none; /* ì´ì „ë´‰ ì‹œê°„ì€ ëª¨ë°”ì¼ì—ì„œ ìˆ¨ê¹€ */
            }
        }
    </style>
</head>
<body>
<div class="app">
    <header>
        <h1>Binance Perp USDT â€” 15m ì´ì „ë´‰ ì¦ê°ë¥  ìŠ¤ìºë„ˆ</h1>
        <p>
            ë°”ì´ë‚¸ìŠ¤ ë¬´ê¸°í•œ ì„ ë¬¼ USDT í˜ì–´ ì „ì²´ë¥¼ ìŠ¤ìº”í•´ì„œ
            <strong>15ë¶„ë´‰ ê¸°ì¤€ ì§ì „ ë´‰(ì´ì „ë´‰)ì˜ (ì¢…ê°€âˆ’ì‹œê°€)/ì‹œê°€ ì¦ê°ë¥ (%)</strong>ì´
            ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.
        </p>
    </header>

    <div class="card">
        <div class="controls">
            <div class="controls-left">
                <button id="scanBtn" type="button">
                    ğŸ” ìŠ¤ìº” ì‹œì‘
                </button>
                <div class="status-text" id="statusText">
                    ì¤€ë¹„ë¨
                </div>
            </div>
            <div class="meta">
                <div class="badge">
                    <span class="badge-dot"></span>
                    <span id="symbolCount">ì‹¬ë³¼ 0ê°œ</span>
                </div>
                <div class="badge">
                    ë§ˆì§€ë§‰ ìŠ¤ìº”:
                    <span id="lastScan" style="margin-left:4px;">-</span>
                </div>
            </div>
        </div>

        <div class="small" style="margin-bottom:8px;">
            â€¢ ì¦ê°ë¥  = (ì´ì „ë´‰ ì¢…ê°€ âˆ’ ì´ì „ë´‰ ì‹œê°€) / ì´ì „ë´‰ ì‹œê°€ Ã— 100<br />
            â€¢ ì‹¬ë³¼ í´ë¦­ ì‹œ <span class="code">/futures/&lt;symbol&gt;</span> ë§ˆì¼“ í˜ì´ì§€ ìƒˆ íƒ­ìœ¼ë¡œ ì´ë™
        </div>

        <div class="table-wrap">
            <table>
                <thead>
                <tr>
                    <th>ì‹¬ë³¼</th>
                    <th>ìˆœìœ„</th>
                    <th>ì´ì „ë´‰ ì‹œê°€</th>
                    <th>ì´ì „ë´‰ ì¢…ê°€</th>
                    <th>ì´ì „ë´‰ ì‹œê°„</th>
                    <th>ì´ì „ë´‰ ì¦ê°ë¥ </th>
                </tr>
                </thead>
                <tbody id="resultBody">
                <tr class="empty-row">
                    <td colspan="6">ì•„ì§ ìŠ¤ìº” ì „ì…ë‹ˆë‹¤. <strong>ìŠ¤ìº” ì‹œì‘</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const API_BASE = "https://fapi.binance.com";
    const INTERVAL = "15m";

    const scanBtn      = document.getElementById("scanBtn");
    const statusText   = document.getElementById("statusText");
    const resultBody   = document.getElementById("resultBody");
    const symbolCount  = document.getElementById("symbolCount");
    const lastScanElem = document.getElementById("lastScan");

    let isScanning = false;

    // ì‹¬ë³¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (USDT ë¬´ê¸°í•œ ì„ ë¬¼ë§Œ í•„í„°)
    async function fetchUsdtPerpSymbols() {
        const url = API_BASE + "/fapi/v1/exchangeInfo";
        const res = await fetch(url);
        if (!res.ok) {
            throw new Error("exchangeInfo ìš”ì²­ ì‹¤íŒ¨: " + res.status);
        }
        const data = await res.json();
        const symbols = (data.symbols || []).filter((s) => {
            return s.quoteAsset === "USDT" &&
                   s.contractType === "PERPETUAL" &&
                   s.status === "TRADING";
        }).map((s) => s.symbol);

        return symbols;
    }

    // íŠ¹ì • ì‹¬ë³¼ì˜ 15m ì´ì „ë´‰ ì¦ê°ë¥  ê³„ì‚°
    async function fetchPrevChange(symbol) {
        // ê°€ì¥ ìµœê·¼ 2ê°œì˜ 15m ë´‰ì„ ê°€ì ¸ì˜¨ë‹¤ê³  ê°€ì •
        const url = API_BASE +
            "/fapi/v1/klines?symbol=" + symbol +
            "&interval=" + INTERVAL +
            "&limit=2";
        const res = await fetch(url);
        if (!res.ok) {
            throw new Error("klines ìš”ì²­ ì‹¤íŒ¨(" + symbol + "): " + res.status);
        }

        const data = await res.json();
        if (!Array.isArray(data) || data.length < 2) {
            return null;
        }

        // data[0] = ì´ì „ë´‰(ë‹«íŒ ë´‰), data[1] = í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë´‰ì´ë¼ê³  ê°€ì •
        const prev = data[0];

        const open  = parseFloat(prev[1]); // ì‹œê°€
        const close = parseFloat(prev[4]); // ì¢…ê°€
        const openTime  = prev[0];         // ms
        const closeTime = prev[6];         // ms

        if (!isFinite(open) || open === 0 || !isFinite(close)) {
            return null;
        }

        const changePct = ((close - open) / open) * 100;

        return {
            symbol,
            open,
            close,
            changePct,
            openTime,
            closeTime
        };
    }

    // ì „ì²´ ì‹¬ë³¼ ìŠ¤ìº” (ë™ì‹œ ìš”ì²­ ê°œìˆ˜ ì œí•œ)
    async function scanAllSymbols(symbols) {
        const results = [];
        const errors  = [];
        const total   = symbols.length;

        const MAX_CONCURRENT = 10;
        let index = 0;
        let done  = 0;

        async function worker() {
            while (true) {
                const myIndex = index++;
                if (myIndex >= total) break;

                const sym = symbols[myIndex];
                try {
                    const row = await fetchPrevChange(sym);
                    if (row) {
                        results.push(row);
                    }
                } catch (err) {
                    console.error("ì—ëŸ¬:", sym, err);
                    errors.push(sym);
                } finally {
                    done++;
                    if (done % 5 === 0 || done === total) {
                        statusText.innerHTML =
                            "ìŠ¤ìº” ì¤‘... <strong>" + done +
                            "</strong> / " + total + " ì™„ë£Œ";
                    }
                }
            }
        }

        const workers = [];
        for (let i = 0; i < MAX_CONCURRENT; i++) {
            workers.push(worker());
        }

        await Promise.all(workers);
        return { results, errors };
    }

    function formatNumber(val, digits) {
        return Number(val).toLocaleString("en-US", {
            minimumFractionDigits: digits,
            maximumFractionDigits: digits
        });
    }

    function formatTime(ms) {
        if (!ms && ms !== 0) return "-";
        const d = new Date(ms);
        return d.toLocaleString("ko-KR", {
            year: "2-digit",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit"
        });
    }

    function renderTable(rows) {
        resultBody.innerHTML = "";

        if (!rows.length) {
            const tr = document.createElement("tr");
            tr.className = "empty-row";
            tr.innerHTML = "<td colspan='6'>ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>";
            resultBody.appendChild(tr);
            return;
        }

        rows.forEach((row, idx) => {
            const tr = document.createElement("tr");

            const chgClass = row.changePct >= 0 ? "chg-pos" : "chg-neg";

            tr.innerHTML =
                "<td class='sym' data-symbol='" + row.symbol + "'>" +
                    row.symbol +
                "</td>" +
                "<td><span class='rank'>#" + (idx + 1) + "</span></td>" +
                "<td>" + formatNumber(row.open, 4) + "</td>" +
                "<td>" + formatNumber(row.close, 4) + "</td>" +
                "<td>" + formatTime(row.openTime) + "</td>" +
                "<td class='" + chgClass + "'>" +
                    (row.changePct >= 0 ? "â–² " : "â–¼ ") +
                    formatNumber(row.changePct, 2) + " %" +
                "</td>";

            resultBody.appendChild(tr);
        });

        // ì‹¬ë³¼ í´ë¦­ ì‹œ ë°”ì´ë‚¸ìŠ¤ ì„ ë¬¼ ë§ˆì¼“ ìƒˆ íƒ­
        resultBody.querySelectorAll(".sym").forEach((td) => {
            td.addEventListener("click", () => {
                const sym = td.getAttribute("data-symbol");
                if (!sym) return;
                const url = "https://www.binance.com/ko/futures/" + sym;
                window.open(url, "_blank");
            });
        });
    }

    async function startScan() {
        if (isScanning) return;
        isScanning = true;
        scanBtn.disabled = true;
        scanBtn.textContent = "ìŠ¤ìº” ì¤‘...";

        statusText.textContent = "USDT ë¬´ê¸°í•œ ì„ ë¬¼ ì‹¬ë³¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
        resultBody.innerHTML = "";
        symbolCount.textContent = "ì‹¬ë³¼ 0ê°œ";

        try {
            const symbols = await fetchUsdtPerpSymbols();
            symbolCount.textContent = "ì‹¬ë³¼ " + symbols.length + "ê°œ";

            statusText.innerHTML =
                "15ë¶„ë´‰ ì´ì „ë´‰ ì¦ê°ë¥  ê³„ì‚° ì¤‘... ì´ <strong>" +
                symbols.length + "</strong>ê°œ ì‹¬ë³¼";

            const { results, errors } = await scanAllSymbols(symbols);

            // ì¦ê°ë¥  ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            results.sort((a, b) => b.changePct - a.changePct);

            renderTable(results);

            const nowStr = new Date().toLocaleString("ko-KR", {
                year: "numeric",
                month: "2-digit",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit"
            });
            lastScanElem.textContent = nowStr;

            if (errors.length) {
                statusText.innerHTML =
                    "ì™„ë£Œ: " + results.length +
                    "ê°œ / ì‹¤íŒ¨: " + errors.length + "ê°œ";
            } else {
                statusText.innerHTML =
                    "ì™„ë£Œ: <strong>" + results.length + "</strong>ê°œ ì‹¬ë³¼ ìŠ¤ìº”";
            }
        } catch (err) {
            console.error(err);
            statusText.textContent = "ì—ëŸ¬ ë°œìƒ: " + err.message;
        } finally {
            isScanning = false;
            scanBtn.disabled = false;
            scanBtn.textContent = "ğŸ” ìŠ¤ìº” ì‹œì‘";
        }
    }

    scanBtn.addEventListener("click", startScan);
</script>
</body>
</html>
